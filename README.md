# Дизайн ML системы - Кейс №1: Автомодерация в соцсетях

## Состав команды
* Будунов Будун - Product Owner
* Сотрудник 1 - Data Scientist / ML Engineer
* Сотрудник 2 - Software Architect

# Описание кейса
**Бизнес-цель:** Автоматизировать мониторинг пользовательских реакций на контент (посты, рекламу, новости) в соцсети, чтобы оперативно выявлять негатив, улучшать модерацию и повышать вовлеченность аудитории.

**Описание текущего процесса:** Сейчас анализ тональности проводится вручную (модераторы читают выборочные комментарии) или не проводится вообще → медленно, дорого, субъективно. Количество комментариев, поступающих ежедневно на модерацию, в среднем доходит до 500_000. При этом со стороны РКН ведется мониторинг качества модерации ресурса, и потенциально неприемлемые комментарии могут навлечь серьезные штрафы и санкции.

# Построенные диаграммы

* Бизнес процессы – BPMN (до внедрения):  
  ![diagrams/до.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/%D0%B4%D0%BE.png)

* Бизнес процессы – BPMN (после внедрения):  
  ![diagrams/После.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/%D0%9F%D0%BE%D1%81%D0%BB%D0%B5.png)

* Структура данных – ERD:  
  ![diagrams/3.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/3.png)

* Архитектура системы (свободная нотация):  
  ![diagrams/4.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/4.png)

* Структурная UML-диаграмма – диаграмма классов:  
  ![diagrams/5.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/5.png)

* Поведенческая UML-диаграмма – диаграмма последовательности:  
  ![diagrams/6.png](https://github.com/budun-ov/-/blob/41b550210dd3175de731280960e8b8bc671a5c9a/diagrams/6.png)

# Цели и предпосылки

## Зачем идем в разработку продукта?
Чтобы автоматизировать процесс модерации, снизить затраты на ручной труд, минимизировать риски штрафов от РКН за неприемлемый контент и повысить вовлеченность пользователей за счет оперативного реагирования на негативные реакции. Это позволит обрабатывать 500_000 комментариев в день эффективно, без субъективности и задержек.

## Почему станет лучше, чем сейчас, от использования ML?
Текущий процесс ручной и выборочный, что приводит к пропускам негатива, высоким затратам и субъективности. ML обеспечит:  
- **Скорость**: обработка в реальном времени.  
- **Объективность**: на основе данных.  
- **Масштабируемость**: без роста штата модераторов.  
- **Экономия**: снижение затрат на персонал на 70-80%.

## Какие бизнес-требования и ограничения вы видите?
**Бизнес-требования:**  
- Выявление негативных комментариев с высокой точностью для избежания штрафов.  
- Поддержка русского языка и сленга.  
- Интеграция с существующими системами соцсети.  
- Отчетность о тональности для анализа контента.  

**Ограничения:**  
- Бюджет на инфраструктуру (GPU для ML).  
- Зависимость от качества данных (нужны размеченные комментарии).  
- Возможное снижение точности на редких случаях (сарказм), что потребует hybrid-подхода с человеком.

## Какие функциональные требования и нефункциональные требования вы видите?
**Функциональные:**  
- Классификация тональности комментариев (позитив/негатив).  
- Автоматическое скрытие негативных комментариев с опцией ручной проверки.  
- API для интеграции с платформой соцсети.  
- Генерация отчетов о распределении тональности.  

**Нефункциональные:**  
- Accuracy > 90% на тестовом датасете.  
- Latency < 200 мс на инференс.  
- Масштабируемость до 1000 RPS.  
- Доступность 99.99%.  
- Поддержка русского языка с учетом сленга.

## Как бы вы построили процесс пилота? Какие критерии успеха выбрали бы?
**Процесс пилота:**  
1. Сбор и разметка датасета (10K комментариев).  
2. Обучение базовой модели.  
3. Запуск на 5% трафика (A/B-тест: ML vs ручная модерация).  
4. Мониторинг метрик в реальном времени.  
5. Сбор фидбека от модераторов.  

**Критерии успеха:**  
- F1-score > 0.88.  
- Снижение ручной модерации на 60%.  
- Обработка 50K комментариев за < 1 минуту без сбоев.  
- Положительный фидбек от бизнеса (снижение жалоб).

## Что, по вашему мнению, должно входить в итерацию работы на MVP, а что остаться техническим долгом?
**MVP:**  
- Базовая модель классификации (RuBERT для тональности).  
- API для анализа комментариев.  
- Интеграция с базой данных.  
- Автоматическое скрытие негатива.  

**Технический долг:**  
- Обработка сарказма и контекста (мультимодальность).  
- Дашборды для мониторинга.  
- A/B-тестирование моделей в production.  
- Оптимизация для мобильных устройств.

# Методология

## Что делаем с технической точки зрения: рекомендательная система, поиск аномалий, регрессия, классификация, и др.
Бинарная классификация текста (позитив/негатив). Используем supervised learning: fine-tuning трансформеров (RuBERT) для анализа тональности. Альтернатива: классические методы как TF-IDF + Logistic Regression для быстрого прототипа.

## Какие данные вам нужны? Без чего точно нельзя решить задачу?
**Обязательно:** Размеченный датасет комментариев (минимум 20K примеров с метками позитив/негатив, на русском языке).  
**Опционально:** Контекст (текст поста, профиль пользователя).  
**Без чего нельзя:** Размеченные данные, так как модель нуждается в supervised обучении.

## Какие метрики качества (метрики машинного обучения) используем и как они связаны с бизнес-результатом?
- **Recall (для негатива) > 0.95**: Чтобы не пропускать нарушения, минимизируя штрафы от РКН.  
- **Precision > 0.85**: Избежать ложных срабатываний, сохраняя доверие пользователей.  
- **F1-score**: Баланс, напрямую влияет на эффективность модерации и снижение затрат.  
- **AUC-ROC**: Оценка качества классификации, коррелирует с общей вовлеченностью (лучше контент - выше метрики).

## Какие могут быть риски на этапе анализа и моделирования и что планируем с этим делать?
**Риски и решения:**  
- Недостаток данных или bias (мало негатива): Решение - активный сбор и аугментация данных.  
- Сложность сарказма/сленга: Решение - использование продвинутых моделей (RuBERT) и human-in-the-loop для разметки.  
- Переобучение: Решение - кросс-валидация и регуляризация.  
- Зависимость от языка: Решение - фокус на русском с использованием предобученных моделей.

# Подготовка пилота

## Способ оценки пилота
A/B-тестирование: Разделить трафик на группу с ML-модерацией и контрольную с ручной. Мониторить метрики качества, скорость и бизнес-метрики (вовлеченность, жалобы). Использовать инструменты вроде Prometheus для логирования.

## Что считаем успешным пилотом
- F1-score > 0.88 в production.  
- Снижение ручной модерации на 70%.  
- Latency < 200 мс при пиковой нагрузке.  
- Нет роста жалоб от пользователей.  
- Положительный ROI (экономия > затрат на разработку).

# Внедрение для production системы

## Архитектура решения
Система включает:  
- **API Gateway (FastAPI)**: Прием комментариев, маршрутизация.  
- **ML Service (Kubernetes pods)**: Инференс модели, обработка задач из очереди.  
- **Task Queue (RabbitMQ)**: Асинхронная обработка для масштабируемости.  
- **Database (PostgreSQL)**: Хранение комментариев, результатов модерации.  
- **Monitoring (Prometheus + Grafana)**: Отслеживание метрик.  

**Взаимосвязи:** API отправляет задачи в очередь, ML обрабатывает и сохраняет в DB.  
**Предназначение:** Обеспечить реал-тайм анализ без блокировок.

## Описание инфраструктуры и масштабируемости: Какая инфраструктура выбрана и почему, плюсы и минусы
**Инфраструктура:** Kubernetes на cloud (Yandex Cloud или AWS) с GPU-нодам для ML, PostgreSQL для DB, RabbitMQ для очередей.  

**Почему:** Kubernetes для авто-масштабирования под нагрузку (500K/день), GPU для быстрого инференса BERT.  

**Плюсы:**  
- Масштабируемость: Авто-добавление подов при пиках.  
- Отказоустойчивость: Репликация.  
- Гибкость: Легко обновлять модели.  

**Минусы:**  
- Сложность настройки (нужен DevOps).  
- Стоимость: GPU и cloud дорогие.  
- Overhead: Не для маленьких систем.

## Требования к системе
- **SLA**: 99.99%.  
- **RPS**: 500+ (пиковая нагрузка).  
- **Latency**: < 200 мс на запрос.  
- **Throughput**: 500K комментариев/день.

## Риски: опишите риски и неопределенности, которые стоит предусмотреть
- **Рост нагрузки**: Решение - автоскейлинг и load testing.  
- **Сбой модели (drift)**: Решение - мониторинг метрик и retraining pipeline.  
- **Безопасность данных**: Решение - шифрование и compliance с GDPR/РКН.  
- **Зависимость от вендоров (cloud)**: Решение - multi-cloud стратегия.  
- **Неопределенность в данных**: Решение - continuous data collection.
